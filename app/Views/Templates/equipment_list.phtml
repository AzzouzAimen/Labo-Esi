<!-- Equipment List -->
<section class="equipment-section">
    <?php
    // Page Header
    $pageHeader = new PageHeader([
        'title' => $lang['equipment_title'] ?? 'Équipements',
        'lang' => $lang
    ]);
    echo $pageHeader->render();
    ?>

    <?php
    // Success/Error Alerts
    if (!empty($success)) {
        $successAlert = new Alert([
            'message' => $success,
            'type' => 'success'
        ]);
        echo $successAlert->render();
    }
    if (!empty($error)) {
        $errorAlert = new Alert([
            'message' => $error,
            'type' => 'error'
        ]);
        echo $errorAlert->render();
    }
    ?>

    <?php
    // Filter Bar
    $filterBarConfig = [
        'filters' => [
            [
                'type' => 'text',
                'id' => 'equip-q',
                'name' => 'q',
                'label' => $lang['search'] ?? 'Recherche',
                'value' => $filters['q'] ?? '',
                'placeholder' => 'Nom, référence...'
            ],
            [
                'type' => 'select',
                'id' => 'equip-category',
                'name' => 'category',
                'label' => $lang['equip_category'] ?? 'Catégorie',
                'value' => $filters['category'] ?? 'all',
                'options' => array_merge(
                    [['value' => 'all', 'label' => $lang['all'] ?? 'Tous']],
                    array_map(fn($cat) => ['value' => $cat, 'label' => $cat], $categories ?? [])
                )
            ],
            [
                'type' => 'select',
                'id' => 'equip-status',
                'name' => 'status',
                'label' => $lang['equip_status'] ?? 'Statut',
                'value' => $filters['status'] ?? 'all',
                'options' => [
                    ['value' => 'all', 'label' => $lang['all'] ?? 'Tous'],
                    ['value' => 'libre', 'label' => $lang['status_free'] ?? 'Libre'],
                    ['value' => 'réservé', 'label' => $lang['status_reserved'] ?? 'Réservé'],
                    ['value' => 'maintenance', 'label' => $lang['status_maintenance'] ?? 'Maintenance']
                ]
            ]
        ],
        'action' => BASE_URL . 'index.php',
        'method' => 'GET',
        'hiddenFields' => [
            'controller' => 'Equipment',
            'action' => 'index'
        ],
        'lang' => $lang
    ];
    $filterBar = new FilterBar($filterBarConfig);
    echo $filterBar->render();
    ?>

    <?php
    // Usage Statistics Section (preserved from original)
    if (!empty($stats)): ?>
        <div style="background: white; border: 1px solid var(--border-color); padding: 1.5rem; margin: 1.5rem 0;">
            <h2 style="color: var(--primary-color); margin-bottom: 1rem;">Statistiques d'utilisation</h2>
            <div style="display: grid; gap: 0.75rem;">
                <?php foreach ($stats as $s): ?>
                    <div style="display: flex; justify-content: space-between; gap: 1rem; padding: 0.75rem; background: var(--bg-light);">
                        <div>
                            <strong><?= $this->escape($s['nom']) ?></strong>
                            <small style="color: var(--text-light);">(<?= $this->escape($s['categorie']) ?>)</small>
                        </div>
                        <div style="color: var(--text-light);">
                            <?= (int)$s['nb_reservations'] ?> réservation(s)
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
    <?php endif; ?>

    <!-- Equipment Grid -->
    <div class="card-grid">
        <?php if (!empty($equipment)): ?>
            <?php foreach ($equipment as $equip): ?>
                <?php
                $equipmentCard = new EquipmentCard([
                    'equipment' => $equip,
                    'lang' => $lang,
                    'baseUrl' => BASE_URL,
                    'userId' => $_SESSION['user_id'] ?? null
                ]);
                echo $equipmentCard->render();
                ?>
            <?php endforeach; ?>
        <?php else: ?>
            <div class="no-results">Aucun équipement trouvé</div>
        <?php endif; ?>
    </div>

    <?php
    // Reservation History Modal (rendered once per page)
    $reservationModal = new ReservationHistoryModal([
        'baseUrl' => BASE_URL
    ]);
    echo $reservationModal->render();
    ?>
</section>
