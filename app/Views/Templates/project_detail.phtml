<!-- Project Detail Template -->

<section class="project-detail">
    <div style="margin-bottom: 2rem;">
        <a href="<?= BASE_URL ?>index.php?controller=Project&action=index" class="btn btn-secondary">
            ◀ <?= $lang['back'] ?>
        </a>
    </div>
    
    <h1 class="section-title"><?= $this->escape($project['titre']) ?></h1>
    
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem;">
        <!-- Main Content -->
        <div>
            <?php if ($project['image_url']): ?>
            <img src="<?= BASE_URL . $this->escape($project['image_url']) ?>" 
                 alt="<?= $this->escape($project['titre']) ?>"
                 style="width: 100%; border-radius: 8px; margin-bottom: 2rem;"
                 onerror="this.style.display='none'">
            <?php endif; ?>
            
            <div style="background: var(--bg-light); padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                <h2 style="color: var(--primary-color); margin-bottom: 1rem;">Description</h2>
                <p style="line-height: 1.8;">
                    <?= $project['description'] ? nl2br($this->escape($project['description'])) : 'Aucune description disponible.' ?>
                </p>
            </div>
            
            <!-- Project Members -->
            <?php if (!empty($members)): ?>
            <div style="background: white; border: 1px solid var(--border-color); padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                <h2 style="color: var(--primary-color); margin-bottom: 1rem;">
                    <?= $lang['project_members'] ?>
                </h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                    <?php foreach ($members as $member): ?>
                    <div style="text-align: center; padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                        <?php if ($member['photo']): ?>
                        <img src="<?= BASE_URL . $this->escape($member['photo']) ?>" 
                             alt="<?= $this->escape($member['prenom'] . ' ' . $member['nom']) ?>"
                             style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 0.5rem;"
                             onerror="this.src='<?= BASE_URL ?>assets/img/user-placeholder.jpg'">
                        <?php else: ?>
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--secondary-color); color: white; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.5rem; font-size: 2rem;">
                            <?= strtoupper(substr($member['prenom'], 0, 1) . substr($member['nom'], 0, 1)) ?>
                        </div>
                        <?php endif; ?>
                        <strong><?= $this->escape($member['prenom'] . ' ' . $member['nom']) ?></strong><br>
                        <small style="color: var(--text-light);"><?= $this->escape($member['grade']) ?></small>
                        <?php if ($member['role_dans_projet']): ?>
                        <br><small style="color: var(--secondary-color);"><?= $this->escape($member['role_dans_projet']) ?></small>
                        <?php endif; ?>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
            <?php endif; ?>
            
            <!-- Project Publications -->
            <?php if (!empty($publications)): ?>
            <div style="background: white; border: 1px solid var(--border-color); padding: 2rem; border-radius: 8px;">
                <h2 style="color: var(--primary-color); margin-bottom: 1rem;">
                    <?= $lang['publications_title'] ?>
                </h2>
                <?php foreach ($publications as $pub): ?>
                <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="color: var(--primary-color);"><?= $this->escape($pub['titre']) ?></h4>
                    <p style="color: var(--text-light); font-size: 0.9rem; margin: 0.5rem 0;">
                        <span class="badge badge-primary"><?= $this->escape($pub['type']) ?></span>
                        <?= date('Y', strtotime($pub['date_publication'])) ?>
                    </p>
                    <?php if ($pub['resume']): ?>
                    <p style="margin-top: 0.5rem;">
                        <?= $this->escape(substr($pub['resume'], 0, 200)) ?>...
                    </p>
                    <?php endif; ?>
                    <?php if ($pub['lien_pdf']): ?>
                    <a href="<?= $this->escape($pub['lien_pdf']) ?>" 
                       target="_blank" 
                       class="btn btn-primary" 
                       style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                        <?= $lang['pub_download'] ?>
                    </a>
                    <?php endif; ?>
                </div>
                <?php endforeach; ?>
            </div>
            <?php endif; ?>
        </div>
        
        <!-- Sidebar -->
        <div>
            <!-- Project Info -->
            <div style="background: white; border: 1px solid var(--border-color); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Informations</h3>
                
                <div style="margin-bottom: 1rem;">
                    <strong style="color: var(--text-light);"><?= $lang['project_domain'] ?>:</strong><br>
                    <span class="badge badge-primary"><?= $this->escape($project['domaine']) ?></span>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <strong style="color: var(--text-light);"><?= $lang['project_status'] ?>:</strong><br>
                    <?php
                    $statusClass = 'badge-primary';
                    if ($project['statut'] === 'terminé') {
                        $statusClass = 'badge-success';
                    } elseif ($project['statut'] === 'soumis') {
                        $statusClass = 'badge-warning';
                    }
                    ?>
                    <span class="badge <?= $statusClass ?>"><?= $this->escape($project['statut']) ?></span>
                </div>
                
                <?php if ($project['responsable_nom']): ?>
                <div style="margin-bottom: 1rem;">
                    <strong style="color: var(--text-light);"><?= $lang['project_manager'] ?>:</strong><br>
                    <?= $this->escape($project['responsable_prenom'] . ' ' . $project['responsable_nom']) ?>
                </div>
                <?php endif; ?>
                
                <?php if ($project['type_financement']): ?>
                <div style="margin-bottom: 1rem;">
                    <strong style="color: var(--text-light);"><?= $lang['project_funding'] ?>:</strong><br>
                    <?= $this->escape($project['type_financement']) ?>
                </div>
                <?php endif; ?>
                
                <?php if ($project['date_debut']): ?>
                <div style="margin-bottom: 1rem;">
                    <strong style="color: var(--text-light);">Date de début:</strong><br>
                    <?= date('d/m/Y', strtotime($project['date_debut'])) ?>
                </div>
                <?php endif; ?>
            </div>
            
            <!-- Project Partners -->
            <?php if (!empty($partners)): ?>
            <div style="background: white; border: 1px solid var(--border-color); padding: 1.5rem; border-radius: 8px;">
                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">
                    <?= $lang['project_partners'] ?>
                </h3>
                <?php foreach ($partners as $partner): ?>
                <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px; margin-bottom: 1rem; text-align: center;">
                    <?php if ($partner['logo_url']): ?>
                    <img src="<?= BASE_URL . $this->escape($partner['logo_url']) ?>" 
                         alt="<?= $this->escape($partner['nom']) ?>"
                         style="max-width: 100px; max-height: 60px; margin-bottom: 0.5rem;"
                         onerror="this.style.display='none'">
                    <?php endif; ?>
                    <strong><?= $this->escape($partner['nom']) ?></strong><br>
                    <small style="color: var(--text-light);"><?= $this->escape($partner['type']) ?></small>
                    <?php if ($partner['site_web']): ?>
                    <br><a href="<?= $this->escape($partner['site_web']) ?>" 
                           target="_blank" 
                           style="font-size: 0.9rem;">Visiter le site</a>
                    <?php endif; ?>
                </div>
                <?php endforeach; ?>
            </div>
            <?php endif; ?>
        </div>
    </div>
</section>
