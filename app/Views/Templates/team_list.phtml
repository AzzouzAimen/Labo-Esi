<!-- Team Listing Template -->

<section class="teams-section">
    <?php
    // Page Header
    $pageHeader = new PageHeader([
        'title' => $lang['teams_title'] ?? 'Équipes',
        'lang' => $lang
    ]);
    echo $pageHeader->render();
    ?>
    
    <div style="text-align: center; margin-bottom: 2rem;">
        <a href="<?= BASE_URL ?>index.php?controller=Team&action=orgChart" class="btn btn-secondary">
            <?= $lang['organizational_chart'] ?>
        </a>
    </div>
    
    <?php if (!empty($teams)): ?>

        <?php
        // Build grade list for filters
        $grades = [];
        foreach ($teams as $t) {
            if (!empty($t['chef_grade'])) {
                $grades[$t['chef_grade']] = true;
            }
            if (!empty($t['members'])) {
                foreach ($t['members'] as $m) {
                    if (!empty($m['grade'])) {
                        $grades[$m['grade']] = true;
                    }
                }
            }
        }
        $grades = array_keys($grades);
        sort($grades);
        ?>

        <div class="filter-bar" style="margin-bottom: 2rem;">
            <div>
                <label for="team-filter-team">Équipe:</label>
                <select id="team-filter-team" class="form-control" style="width: auto; display: inline-block;">
                    <option value="all"><?= $lang['all'] ?></option>
                    <?php foreach ($teams as $t): ?>
                        <option value="<?= (int)$t['id_team'] ?>"><?= $this->escape($t['nom']) ?></option>
                    <?php endforeach; ?>
                </select>
            </div>

            <div>
                <label for="team-filter-grade">Grade:</label>
                <select id="team-filter-grade" class="form-control" style="width: auto; display: inline-block;">
                    <option value="all"><?= $lang['all'] ?></option>
                    <?php foreach ($grades as $g): ?>
                        <option value="<?= $this->escape($g) ?>"><?= $this->escape($g) ?></option>
                    <?php endforeach; ?>
                </select>
            </div>

            <div>
                <label for="team-sort">Tri:</label>
                <select id="team-sort" class="form-control" style="width: auto; display: inline-block;">
                    <option value="name">Nom</option>
                    <option value="grade">Grade</option>
                </select>
            </div>
        </div>

        <div class="team-container">
            <?php foreach ($teams as $team): ?>
                <?php
                // Use TeamSection component for each team
                $teamSection = new TeamSection([
                    'team' => $team,
                    'lang' => $lang,
                    'baseUrl' => BASE_URL,
                    'showPublicationsLink' => true
                ]);
                echo $teamSection->render();
                ?>
            <?php endforeach; ?>
        </div>
    <?php else: ?>
        <div class="no-results">
            <?= $lang['no_teams'] ?>
        </div>
    <?php endif; ?>
</section>
