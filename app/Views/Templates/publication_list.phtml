<!-- Publications List -->
<section class="publications-section">
    <?php
    // Page Header
    $pageHeader = new PageHeader([
        'title' => $lang['publications_title'] ?? 'Publications',
        'lang' => $lang
    ]);
    echo $pageHeader->render();
    ?>

    <div class="filter-bar">
        <div>
            <label for="pub-search"><?= $lang['search'] ?>:</label>
            <input id="pub-search" class="form-control" style="width: 260px; display: inline-block;" type="text" value="<?= $this->escape($filters['q'] ?? '') ?>" placeholder="Titre, auteur, résumé, DOI...">
        </div>

        <div>
            <label for="pub-filter-year">Année:</label>
            <select id="pub-filter-year" class="form-control" style="width: auto; display: inline-block;">
                <option value="all"><?= $lang['all'] ?></option>
                <?php if (!empty($years)): ?>
                    <?php foreach ($years as $y): ?>
                        <option value="<?= (int)$y ?>" <?= (($filters['year'] ?? 'all') == $y) ? 'selected' : '' ?>><?= (int)$y ?></option>
                    <?php endforeach; ?>
                <?php endif; ?>
            </select>
        </div>

        <div>
            <label for="pub-filter-author">Auteur:</label>
            <select id="pub-filter-author" class="form-control" style="width: auto; display: inline-block;">
                <option value="all"><?= $lang['all'] ?></option>
                <?php if (!empty($authors)): ?>
                    <?php foreach ($authors as $a): ?>
                        <option value="<?= (int)$a['id_user'] ?>" <?= (($filters['author'] ?? 'all') == $a['id_user']) ? 'selected' : '' ?>>
                            <?= $this->escape($a['prenom'] . ' ' . $a['nom']) ?>
                        </option>
                    <?php endforeach; ?>
                <?php endif; ?>
            </select>
        </div>

        <div>
            <label for="pub-filter-type"><?= $lang['pub_type'] ?>:</label>
            <select id="pub-filter-type" class="form-control" style="width: auto; display: inline-block;">
                <option value="all"><?= $lang['all'] ?></option>
                <?php if (!empty($types)): ?>
                    <?php foreach ($types as $t): ?>
                        <option value="<?= $this->escape($t) ?>" <?= (($filters['type'] ?? 'all') == $t) ? 'selected' : '' ?>>
                            <?= $this->escape($t) ?>
                        </option>
                    <?php endforeach; ?>
                <?php endif; ?>
            </select>
        </div>

        <div>
            <label for="pub-filter-domain"><?= $lang['project_domain'] ?>:</label>
            <select id="pub-filter-domain" class="form-control" style="width: auto; display: inline-block;">
                <option value="all"><?= $lang['all'] ?></option>
                <?php if (!empty($domains)): ?>
                    <?php foreach ($domains as $d): ?>
                        <option value="<?= $this->escape($d) ?>" <?= (($filters['domain'] ?? 'all') == $d) ? 'selected' : '' ?>>
                            <?= $this->escape($d) ?>
                        </option>
                    <?php endforeach; ?>
                <?php endif; ?>
            </select>
        </div>

        <div>
            <label for="pub-filter-project">Projet:</label>
            <select id="pub-filter-project" class="form-control" style="width: auto; display: inline-block;">
                <option value="all"><?= $lang['all'] ?></option>
                <?php if (!empty($projects)): ?>
                    <?php foreach ($projects as $proj): ?>
                        <option value="<?= (int)$proj['id_project'] ?>" <?= (($filters['project'] ?? 'all') == $proj['id_project']) ? 'selected' : '' ?>>
                            <?= $this->escape($proj['titre']) ?>
                        </option>
                    <?php endforeach; ?>
                <?php endif; ?>
            </select>
        </div>

        <div>
            <label for="pub-sort">Tri:</label>
            <select id="pub-sort" class="form-control" style="width: auto; display: inline-block;">
                <option value="date_desc" <?= (($sort ?? 'date_desc') === 'date_desc') ? 'selected' : '' ?>>Date (récent → ancien)</option>
                <option value="date_asc" <?= (($sort ?? 'date_desc') === 'date_asc') ? 'selected' : '' ?>>Date (ancien → récent)</option>
                <option value="title_asc" <?= (($sort ?? 'date_desc') === 'title_asc') ? 'selected' : '' ?>>Titre (A → Z)</option>
                <option value="title_desc" <?= (($sort ?? 'date_desc') === 'title_desc') ? 'selected' : '' ?>>Titre (Z → A)</option>
            </select>
        </div>
    </div>

    <div id="publications-list" class="document-list"
         data-page="<?= (int)($page ?? 1) ?>"
         data-total-pages="<?= (int)($totalPages ?? 1) ?>"
         data-per-page="<?= (int)($perPage ?? 6) ?>"
         data-team="<?= $this->escape($filters['team'] ?? 'all') ?>"
         data-project="<?= $this->escape($filters['project'] ?? 'all') ?>">

        <?php if (!empty($publications)): ?>
            <?php foreach ($publications as $pub): ?>
                <?php
                $publicationItem = new PublicationItem([
                    'publication' => $pub,
                    'lang' => $lang,
                    'truncateAbstract' => 250
                ]);
                echo $publicationItem->render();
                ?>
            <?php endforeach; ?>
        <?php else: ?>
            <div class="no-results">Aucune publication trouvée</div>
        <?php endif; ?>
    </div>

    <?php if (!empty($totalPages) && (int)$totalPages > 1): ?>
        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
            <button type="button" class="btn btn-secondary" id="pub-prev">Précédent</button>
            <div style="align-self: center; color: var(--text-light);">
                Page <span id="pub-page-label"><?= (int)($page ?? 1) ?></span> / <span id="pub-total-label"><?= (int)($totalPages ?? 1) ?></span>
            </div>
            <button type="button" class="btn btn-secondary" id="pub-next">Suivant</button>
        </div>
    <?php endif; ?>
</section>
