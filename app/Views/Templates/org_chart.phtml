<!-- Organizational Chart Template -->
<section class="orgchart-section">
    <div style="margin-bottom: 2rem;">
        <a href="<?= BASE_URL ?>index.php?controller=Team&action=index" class="btn btn-secondary">◀ <?= $lang['back'] ?></a>
    </div>

    <h1 class="section-title"><?= $lang['organizational_chart'] ?></h1>

    <?php if (!empty($groupedMembers)): ?>
        <?php
        $roleLabels = [
            'admin' => 'Direction / Administration',
            'enseignant-chercheur' => 'Enseignants-Chercheurs',
            'doctorant' => 'Doctorants',
            'etudiant' => 'Étudiants'
        ];
        ?>

        <?php foreach ($roleLabels as $role => $label): ?>
            <div style="margin: 2rem 0;">
                <h2 style="color: var(--primary-color); margin-bottom: 1rem;">
                    <?= $this->escape($label) ?>
                    <span style="background: var(--secondary-color); color: white; padding: 0.2rem 0.6rem; font-size: 0.9rem;">
                        <?= !empty($groupedMembers[$role]) ? count($groupedMembers[$role]) : 0 ?>
                    </span>
                </h2>

                <?php if (!empty($groupedMembers[$role])): ?>
                    <div class="card-grid">
                        <?php foreach ($groupedMembers[$role] as $m): ?>
                            <div class="card">
                                <div class="card-body" style="text-align: center;">
                                    <?php if (!empty($m['photo'])): ?>
                                        <img src="<?= BASE_URL . $this->escape($m['photo']) ?>" alt="<?= $this->escape($m['prenom'] . ' ' . $m['nom']) ?>" style="width: 110px; height: 110px; object-fit: cover; margin: 0 auto 1rem;" onerror="this.src='<?= BASE_URL ?>assets/img/user-placeholder.jpg'">
                                    <?php else: ?>
                                        <div style="width: 110px; height: 110px; background: var(--secondary-color); color: white; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; margin: 0 auto 1rem; border: 3px solid var(--secondary-color);">
                                            <?= strtoupper(substr($m['prenom'], 0, 1) . substr($m['nom'], 0, 1)) ?>
                                        </div>
                                    <?php endif; ?>

                                    <h3 class="card-title" style="margin-bottom: 0.25rem;">
                                        <?= $this->escape($m['prenom'] . ' ' . $m['nom']) ?>
                                    </h3>

                                    <p style="color: var(--text-light); margin: 0.25rem 0;">
                                        <?= $this->escape($m['grade']) ?>
                                    </p>

                                    <?php if (!empty($m['poste'])): ?>
                                        <p style="color: var(--text-light); margin: 0;">
                                            <?= $this->escape($m['poste']) ?>
                                        </p>
                                    <?php endif; ?>

                                    <div style="margin-top: 1rem;">
                                        <a href="<?= BASE_URL ?>index.php?controller=Team&action=profile&id=<?= (int)$m['id_user'] ?>" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                                            <?= $lang['view_details'] ?>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                <?php else: ?>
                    <div class="no-results">Aucun membre</div>
                <?php endif; ?>
            </div>
        <?php endforeach; ?>
    <?php else: ?>
        <div class="no-results">Aucun membre</div>
    <?php endif; ?>
</section>
